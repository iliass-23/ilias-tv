<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ILIAS-TV</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

  body {
    margin: 0;
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #0f1c2a, #1b2b3f, #0c1a33);
    color: #fff;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    text-align: center;
    padding: 25px 10px;
    font-size: 2.2rem;
    font-weight: 700;
  }

  .menu, .channels {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    padding: 20px;
    flex: 1;
    overflow-y: auto;
  }

  .item {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 500;
    cursor: pointer;
    transition: transform 0.15s, background 0.15s;
    border: 1px solid rgba(255,255,255,0.12);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100px;
  }

  .item:hover, .active {
    background: rgba(255,255,255,0.15);
    transform: scale(1.03);
    color: #000;
  }

  video {
    width: 95%;
    max-width: 1100px;
    margin: 25px auto;
    display: block;
    border-radius: 16px;
    background: black;
    border: 1px solid rgba(255,255,255,0.15);
  }

  button {
    display: block;
    margin: 20px auto;
    padding: 12px 25px;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,0.12);
    color: #000;
    font-weight: 700;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.2s, transform 0.15s;
  }

  button:hover {
    background: rgba(255,255,255,0.2);
    transform: scale(1.03);
  }

  #loading {
    text-align: center;
    font-size: 1.2rem;
    padding: 10px;
  }

  footer {
    text-align: center;
    padding: 15px;
    background: rgba(0,0,0,0.2);
    font-size: 0.95rem;
  }

  footer span.heart {
    color: red;
  }

  /* Scrollbar for TV */
  .menu::-webkit-scrollbar, .channels::-webkit-scrollbar {
    width: 10px;
  }
  .menu::-webkit-scrollbar-thumb, .channels::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.2);
    border-radius: 5px;
  }
</style>
</head>
<body>

<header>ILIAS-TV</header>
<div id="app"></div>
<div id="loading" style="display:none;">Loading stream...</div>
<footer>ILIAS-TV | Made with <span class="heart">❤️</span> for Arabic TV lovers</footer>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const playlistUrl = "https://iptv-org.github.io/iptv/languages/ara.m3u";
const app = document.getElementById("app");
const loading = document.getElementById("loading");
let data = {};
let focusIndex = 0;
let items = [];
let currentVideo = null;

async function loadPlaylist() {
  try {
    const res = await fetch(playlistUrl);
    const text = await res.text();
    const lines = text.split(/\r?\n/);
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];
      if (line.startsWith("#EXTINF")) {
        const categoryMatch = line.match(/group-title="(.*?)"/);
        const category = categoryMatch ? categoryMatch[1] : "Other";
        const nameMatch = line.match(/,(.*)$/);
        const name = nameMatch ? nameMatch[1].trim() : "Unnamed";
        let url = lines[i + 1] ? lines[i + 1].trim() : null;
        if (!url || url.startsWith("#")) continue;
        if (!data[category]) data[category] = [];
        data[category].push({ name, url });
      }
    }
    showCategories();
  } catch (err) {
    app.innerHTML = "<p style='text-align:center;color:red;'>Failed to load playlist.</p>";
    console.error(err);
  }
}

function showCategories() {
  stopCurrentVideo();
  app.innerHTML = "<div class='menu'>" +
    Object.keys(data).map(c => `<div class='item' onclick="showChannels('${c}')">${c}</div>`).join("") +
    "</div>";
  focusIndex = 0;
  updateFocus();
}

function showChannels(category) {
  stopCurrentVideo();
  app.innerHTML = `<h2 style="text-align:center;">${category}</h2>
    <div class='channels'>` +
    data[category].map(ch => `<div class='item' onclick="playChannel('${ch.url}')">${ch.name}</div>`).join("") +
    `</div>
    <button onclick='showCategories()'>⬅ Back</button>`;
  focusIndex = 0;
  updateFocus();
}

function playChannel(url) {
  stopCurrentVideo();
  app.innerHTML = `<video id="video" controls autoplay></video>
                   <button onclick='showCategories()'>⬅ Back</button>`;
  const video = document.getElementById("video");
  currentVideo = video;
  loading.style.display = "block";

  const startHLS = (sourceUrl) => {
    if (Hls.isSupported()) {
      const hls = new Hls({
        lowLatencyMode: true,
        maxBufferLength: 10,
        maxMaxBufferLength: 30,
        capLevelToPlayerSize: true,
        maxBufferHole: 0.5,
        autoStartLoad: true
      });
      hls.loadSource(sourceUrl);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        loading.style.display = "none";
        video.play();
      });
      hls.on(Hls.Events.FRAG_PARSED, () => { if(video.paused) video.play(); });
      hls.on(Hls.Events.ERROR, function(event,data) {
        if(data.fatal){
          hls.destroy();
          startHLS("https://cors-anywhere.herokuapp.com/" + url);
        }
      });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = sourceUrl;
      video.addEventListener('loadedmetadata', ()=>{loading.style.display="none";video.play();});
    } else { alert("Cannot play this stream"); loading.style.display="none"; }
    video.requestFullscreen?.();
  };
  startHLS(url);
}

function stopCurrentVideo() {
  if(currentVideo){
    currentVideo.pause();
    currentVideo.src = "";
    currentVideo.load();
    currentVideo = null;
  }
}

function updateFocus() {
  items = document.querySelectorAll(".item");
  items.forEach(i => i.classList.remove("active"));
  if(items[focusIndex]) {
    items[focusIndex].classList.add("active");
    items[focusIndex].scrollIntoView({ behavior:"smooth", block:"center" });
  }
}

document.addEventListener("keydown", e => {
  if(!items.length) return;
  switch(e.key){
    case "ArrowDown":
      items[focusIndex].classList.remove("active");
      focusIndex=(focusIndex+1)%items.length; updateFocus(); break;
    case "ArrowUp":
      items[focusIndex].classList.remove("active");
      focusIndex=(focusIndex-1+items.length)%items.length; updateFocus(); break;
    case "ArrowRight":
    case "Enter": items[focusIndex].click(); break;
    case "Backspace":
    case "Escape": showCategories(); break;
  }
});

loadPlaylist();
</script>

</body>
</html>

