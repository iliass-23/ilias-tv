<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ILIAS-TV - Arabic IPTV Player</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#0F172A,#1E293B,#4C1D95);
  min-height:100vh;
  margin:0;
  color:white;
  cursor: default; /* always show cursor */
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:20px;
}

.grid-horizontal{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:1rem;
}

.card{
  border-radius:16px;
  overflow:hidden;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.1);
  text-align:center;
  cursor:pointer;
  transition:all 0.3s ease;
}

.card:hover{
  background:rgba(255,255,255,0.1);
  transform:translateY(-5px);
}

.channel-logo{
  width:100%;
  height:100px;
  object-fit:contain;
  background:rgba(0,0,0,0.2);
}

.video-container{
  border-radius:16px;
  overflow:hidden;
  background:#000;
  border:1px solid rgba(255,255,255,0.1);
}

.focused{
  outline:3px solid #8B5CF6;
  outline-offset:-3px;
}

.playing{
  border:2px solid #8B5CF6;
  box-shadow:0 0 15px rgba(139,92,246,0.5);
}

.scrollbar-thin::-webkit-scrollbar{
  width:8px;
}
.scrollbar-thin::-webkit-scrollbar-track{
  background:rgba(255,255,255,0.05);
  border-radius:4px;
}
.scrollbar-thin::-webkit-scrollbar-thumb{
  background:rgba(139,92,246,0.5);
  border-radius:4px;
}
.scrollbar-thin::-webkit-scrollbar-thumb:hover{
  background:rgba(139,92,246,0.8);
}

button:focus{outline:none;}
</style>
</head>
<body>
<div class="container">
<header class="text-center mb-6">
  <div class="flex justify-center items-center mb-3 space-x-3">
    <i class="fas fa-tv text-4xl text-purple-500"></i>
    <h1 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-pink-500">ILIAS-TV</h1>
  </div>
  <p class="text-gray-300">Premium Arabic IPTV Streaming Experience</p>
</header>

<main id="app">
  <div id="loading" class="text-center py-12 hidden">
    <div class="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
    <p>Loading channels...</p>
  </div>

  <!-- Categories -->
  <div id="categories-view" class="grid-horizontal scrollbar-thin"></div>

  <!-- Channels -->
  <div id="channels-view" class="grid-horizontal scrollbar-thin hidden"></div>

  <!-- Player -->
  <div id="player-view" class="hidden">
    <div class="mb-4 flex justify-between items-center">
      <h2 id="channel-name" class="text-2xl font-bold"></h2>
      <button id="back-to-channels" class="px-4 py-2 bg-purple-500 rounded flex items-center">
        <i class="fas fa-arrow-left mr-2"></i> Back
      </button>
    </div>
    <div class="video-container mb-4">
      <video id="video-player" class="w-full" controls autoplay></video>
    </div>
    <div class="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex items-center space-x-4">
      <img id="playing-logo" class="w-16 h-16 rounded-lg" src="" alt="Logo">
      <div>
        <p id="playing-channel" class="font-medium"></p>
        <p id="playing-category" class="text-gray-300 text-sm"></p>
      </div>
    </div>
  </div>
</main>

<footer class="text-center mt-6 py-6 border-t border-gray-800">
  <p>Made with <span class="text-red-500">❤️</span> for Arabic TV lovers</p>
  <p class="text-gray-500 text-sm mt-2">© 2025 ILIAS-TV. All rights reserved.</p>
</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
// Elements
const categoriesView = document.getElementById('categories-view');
const channelsView = document.getElementById('channels-view');
const playerView = document.getElementById('player-view');
const videoPlayer = document.getElementById('video-player');
const backToChannels = document.getElementById('back-to-channels');
const channelName = document.getElementById('channel-name');
const playingLogo = document.getElementById('playing-logo');
const playingChannel = document.getElementById('playing-channel');
const playingCategory = document.getElementById('playing-category');
const loading = document.getElementById('loading');

// State
let data = {};
let categoryItems = [];
let channelItems = [];
let focusIndex = 0;
let currentCategory = '';
let currentHls = null;
let currentPlayingChannel = null;

// Category Icons
const categoryIcons = {
    "News":"fa-newspaper",
    "Sports":"fa-futbol",
    "Movies":"fa-film",
    "Music":"fa-music",
    "Kids":"fa-child",
    "Religion":"fa-star-and-crescent", // Islam icon
    "Business":"fa-briefcase",
    "Documentary":"fa-book",
    "Comedy":"fa-mask",
    "Cooking":"fa-utensils",
    "Other":"fa-tv"
};

// Load playlist
async function loadPlaylist(){
    loading.classList.remove('hidden');
    try{
        const res = await fetch("https://iptv-org.github.io/iptv/languages/ara.m3u");
        const text = await res.text();
        const lines = text.split(/\r?\n/);
        for(let i=0;i<lines.length;i++){
            if(lines[i].startsWith("#EXTINF")){
                const catMatch = lines[i].match(/group-title="(.*?)"/);
                let category = catMatch ? catMatch[1] : "Other";
                // normalize categories
                if(category.toLowerCase().includes("religion")) category="Religion";
                else if(category.toLowerCase().includes("business")) category="Business";
                else if(category.toLowerCase().includes("doc")) category="Documentary";
                else if(category.toLowerCase().includes("comedy")) category="Comedy";
                else if(category.toLowerCase().includes("cook")) category="Cooking";
                else if(category.toLowerCase().includes("kids")) category="Kids";
                else if(category.toLowerCase().includes("movie")) category="Movies";
                else if(category.toLowerCase().includes("music")) category="Music";
                else if(category.toLowerCase().includes("sport")) category="Sports";
                const nameMatch = lines[i].match(/,(.*)$/);
                const name = nameMatch ? nameMatch[1].trim() : "Unnamed";
                const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
                const logo = logoMatch ? logoMatch[1] : null;
                const url = lines[i+1] ? lines[i+1].trim() : null;
                if(!url || url.startsWith("#")) continue;
                if(!data[category]) data[category]=[];
                data[category].push({name,url,logo});
            }
        }
        showCategories();
    }catch(e){ console.error(e); alert("Failed to load playlist"); }
}

// Show categories
function showCategories(){
    loading.classList.add('hidden');
    categoriesView.classList.remove('hidden');
    channelsView.classList.add('hidden');
    playerView.classList.add('hidden');
    categoriesView.innerHTML='';
    categoryItems=[];
    Object.keys(data).forEach(cat=>{
        const icon = categoryIcons[cat]||"fa-tv";
        const card = document.createElement('div');
        card.className='card p-4 flex flex-col items-center';
        card.innerHTML=`<div class="w-16 h-16 rounded-full bg-purple-500 flex items-center justify-center mb-3">
            <i class="fas ${icon} text-2xl"></i>
        </div><h3 class="font-semibold">${cat}</h3><p class="text-xs text-gray-400 mt-1">${data[cat].length} channels</p>`;
        card.addEventListener('click',()=>showChannels(cat));
        categoriesView.appendChild(card);
        categoryItems.push(card);
    });
    focusIndex=0;
    updateFocus(categoryItems);
}

// Show channels
function showChannels(cat){
    currentCategory = cat;
    loading.classList.add('hidden');
    categoriesView.classList.add('hidden');
    channelsView.classList.remove('hidden');
    playerView.classList.add('hidden');
    channelsView.innerHTML='';
    
    // Back button
    const backBtn = document.createElement('button');
    backBtn.textContent = '← Back to Categories';
    backBtn.className = 'mb-4 px-4 py-2 bg-purple-500 rounded';
    backBtn.addEventListener('click', () => { stopCurrentVideo(); showCategories(); });
    channelsView.appendChild(backBtn);

    channelItems=[];
    data[cat].forEach(ch=>{
        const card = document.createElement('div');
        card.className='card p-3';
        card.innerHTML=`<div class="channel-logo mb-3 flex items-center justify-center">
            ${ch.logo?`<img src="${ch.logo}" alt="${ch.name}" class="w-full h-full object-contain p-2">`:`<i class="fas fa-play-circle text-4xl text-gray-400"></i>`}
        </div><h3 class="font-medium">${ch.name}</h3>`;
        card.addEventListener('click',()=>playChannel(ch));
        channelsView.appendChild(card);
        channelItems.push(card);
    });
    focusIndex=0;
    updateFocus(channelItems);
}

// Play channel
function playChannel(channel){
    stopCurrentVideo();
    categoriesView.classList.add('hidden');
    channelsView.classList.add('hidden');
    playerView.classList.remove('hidden');

    currentPlayingChannel = channel;
    channelName.textContent = channel.name;
    playingLogo.src = channel.logo||"";
    playingChannel.textContent = channel.name;
    playingCategory.textContent = currentCategory;

    if(Hls.isSupported()){
        currentHls = new Hls();
        currentHls.loadSource(channel.url);
        currentHls.attachMedia(videoPlayer);
    }else{
        videoPlayer.src = channel.url;
    }
    videoPlayer.play();
    videoPlayer.requestFullscreen();
}

// Stop current video
function stopCurrentVideo(){
    if(currentHls){currentHls.destroy(); currentHls=null;}
    videoPlayer.pause();
    videoPlayer.src="";
}

// Keyboard navigation
document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight'){ focusIndex = (focusIndex+1)%categoryItems.length; updateFocus(categoryItems); }
    if(e.key==='ArrowLeft'){ focusIndex = (focusIndex-1+categoryItems.length)%categoryItems.length; updateFocus(categoryItems); }
    if(e.key==='Enter'){ categoryItems[focusIndex].click(); }
});

// Update focus
function updateFocus(items){
    items.forEach((c,i)=>c.classList.remove('focused'));
    if(items[focusIndex]) items[focusIndex].classList.add('focused');
}

// Back button
backToChannels.addEventListener('click',()=>{ stopCurrentVideo(); showChannels(currentCategory); });

// Start
loadPlaylist();
</script>
</body>
</html>
