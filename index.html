<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ILIAS-TV - Futuristic IPTV</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#0F172A,#1E293B,#4C1D95);
  min-height:100vh;
  margin:0;
  color:white;
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:20px;
}

header h1{
  font-size:3rem;
  background: linear-gradient(90deg,#8B5CF6,#4C1D95);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight:700;
}

.grid-horizontal {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
}

.card {
  border-radius:20px;
  overflow:hidden;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
  border:1px solid rgba(255,255,255,0.1);
  text-align:center;
  cursor:pointer;
  transition: all 0.3s ease;
  aspect-ratio: 1 / 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.card:hover{
  transform: translateY(-6px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}

.channel-logo{
  width:100%;
  height:120px;
  object-fit:contain;
  background: rgba(0,0,0,0.2);
  border-radius:12px;
}

.video-container, .iframe-container{
  border-radius:20px;
  overflow:hidden;
  background:#000;
  border:1px solid rgba(255,255,255,0.1);
}

input#search-input{
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.15);
  padding:0.5rem 1rem;
  color:white;
  width:100%;
  max-width:300px;
  transition: all 0.3s ease;
}
input#search-input:focus{
  outline:none;
  border:1px solid #8B5CF6;
  box-shadow: 0 4px 15px rgba(139,92,246,0.3);
}

button{
  transition: all 0.3s ease;
}
button:hover{
  transform: translateY(-2px);
}

.scrollbar-thin::-webkit-scrollbar{
  width:8px;
}
.scrollbar-thin::-webkit-scrollbar-track{
  background:rgba(255,255,255,0.05);
  border-radius:4px;
}
.scrollbar-thin::-webkit-scrollbar-thumb{
  background:rgba(139,92,246,0.5);
  border-radius:4px;
}
.scrollbar-thin::-webkit-scrollbar-thumb:hover{
  background:rgba(139,92,246,0.8);
}

/* Responsive tweaks */
@media (max-width: 640px) {
  .grid-horizontal {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media (min-width: 641px) and (max-width: 1024px) {
  .grid-horizontal {
    grid-template-columns: repeat(4, 1fr);
  }
}
@media (min-width: 1025px) {
  .grid-horizontal {
    grid-template-columns: repeat(6, 1fr);
  }
}

/* ✅ Force scrolling on all devices */
html, body {
  height: 100%;
  overflow-y: auto !important;
  overscroll-behavior: contain;
}
</style>
</head>
<body>

<!-- Fake Login -->
<div id="fakeLogin" class="flex flex-col items-center justify-center h-screen text-center">
  <h2 class="text-2xl font-bold text-purple-400 mb-4">M3U / Xtream Player</h2>
  <input id="fakeInput" type="text" placeholder="Enter playlist link"
         class="w-80 p-2 rounded-lg text-black text-center mb-4" />
  <button onclick="fakeGo()" 
          class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg shadow-lg">
    GO
  </button>
</div>

<!-- Real Website (hidden at first) -->
<div id="mainContent" style="display:none;">
<div class="container">
<header class="text-center mb-6">
  <div class="flex justify-center items-center mb-3 space-x-3">
    <i class="fas fa-tv text-4xl text-purple-500"></i>
    <h1>ILIAS-TV</h1>
  </div>
  <p class="text-gray-300">Premium Arabic IPTV Streaming Experience</p>
</header>

<main id="app">
  <div id="loading" class="text-center py-12 hidden">
    <div class="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
    <p>Loading channels...</p>
  </div>

  <!-- Categories -->
  <div id="categories-view" class="grid-horizontal scrollbar-thin"></div>

  <!-- Channels -->
  <div id="channels-view" class="hidden">
    <div class="mb-4 flex justify-between items-center flex-wrap gap-4">
      <input id="search-input" type="text" placeholder="Search channels...">
      <button id="back-to-categories" class="px-4 py-2 bg-purple-500 rounded flex items-center">
        <i class="fas fa-arrow-left mr-2"></i> Back
      </button>
    </div>
    <div id="channels-list" class="grid-horizontal scrollbar-thin"></div>
  </div>

  <!-- Player -->
  <div id="player-view" class="hidden">
    <div class="mb-4 flex justify-between items-center flex-wrap gap-4">
      <h2 id="channel-name" class="text-2xl font-bold"></h2>
      <button id="back-to-channels" class="px-4 py-2 bg-purple-500 rounded flex items-center">
        <i class="fas fa-arrow-left mr-2"></i> Back
      </button>
    </div>
    <div class="video-container mb-4" id="video-container">
      <video id="video-player" class="w-full" controls autoplay playsinline preload="metadata"></video>
    </div>
    <div class="iframe-container mb-4 hidden" id="iframe-container">
      <iframe id="iframe-player" class="w-full" height="600px" frameborder="0" allowfullscreen></iframe>
    </div>
    <div class="bg-gray-800 bg-opacity-50 rounded-xl p-4 flex items-center space-x-4">
      <img id="playing-logo" class="w-16 h-16 rounded-lg" src="" alt="Logo">
      <div>
        <p id="playing-channel" class="font-medium"></p>
        <p id="playing-category" class="text-gray-300 text-sm"></p>
      </div>
    </div>
    <p id="player-hint" class="text-sm text-gray-300 mt-2"></p>
  </div>
</main>

<footer class="text-center mt-6 py-6 border-t border-gray-800">
<p>Made with <span class="text-red-500">❤️</span> for Arabic TV lovers</p>
<p class="text-gray-500 text-sm mt-2">© 2025 ILIAS-TV. All rights reserved.</p>
<div class="mt-2 space-x-4">
<a href="https://iliass-23.github.io/ilias-tv/license.html"
class="text-purple-400 hover:underline" target="_blank">License</a>
<a href="https://iliass-23.github.io/ilias-tv/terms.html"
class="text-purple-400 hover:underline" target="_blank">Terms of Use</a>
<a href="https://iliass-23.github.io/ilias-tv/privacy.html"
class="text-purple-400 hover:underline" target="_blank">Privacy Policy</a>
</div>
</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>

// Elements
const categoriesView = document.getElementById('categories-view');
const channelsView = document.getElementById('channels-view');
const channelsList = document.getElementById('channels-list');
const playerView = document.getElementById('player-view');
const videoContainer = document.getElementById('video-container');
const videoPlayer = document.getElementById('video-player');
const iframeContainer = document.getElementById('iframe-container');
const iframePlayer = document.getElementById('iframe-player');
const backToChannels = document.getElementById('back-to-channels');
const backToCategories = document.getElementById('back-to-categories');
const channelName = document.getElementById('channel-name');
const playingLogo = document.getElementById('playing-logo');
const playingChannel = document.getElementById('playing-channel');
const playingCategory = document.getElementById('playing-category');
const loading = document.getElementById('loading');
const searchInput = document.getElementById('search-input');

let data = {};
let categoryItems = [];
let channelItems = [];
let currentCategory = '';
let currentHls = null;

const categoryIcons = {
    "News":"fa-newspaper",
    "Sports":"fa-futbol",
    "Movies":"fa-film",
    "Music":"fa-music",
    "Kids":"fa-child",
    "Religion":"fa-star-and-crescent",
    "Business":"fa-briefcase",
    "Documentary":"fa-book",
    "Comedy":"fa-mask",
    "Cooking":"fa-utensils",
    "Maghreb":"fa-flag",
    "Other":"fa-tv"
};

async function loadPlaylist(){
    loading.classList.remove('hidden');
    try{
        // Load Arabic playlist (ara.m3u)
        const res = await fetch("https://iptv-org.github.io/iptv/languages/ara.m3u");
        const text = await res.text();
        const lines = text.split(/\r?\n/);
        for(let i=0;i<lines.length;i++){
            if(lines[i].startsWith("#EXTINF")){
                const catMatch = lines[i].match(/group-title="(.*?)"/);
                let category = catMatch ? catMatch[1] : "Other";
                if(category.toLowerCase().includes("religion")) category="Religion";
                else if(category.toLowerCase().includes("business")) category="Business";
                else if(category.toLowerCase().includes("doc")) category="Documentary";
                else if(category.toLowerCase().includes("comedy")) category="Comedy";
                else if(category.toLowerCase().includes("cook")) category="Cooking";
                else if(category.toLowerCase().includes("kids")) category="Kids";
                else if(category.toLowerCase().includes("movie")) category="Movies";
                else if(category.toLowerCase().includes("music")) category="Music";
                else if(category.toLowerCase().includes("sport")) category="Sports";
                else if(category.toLowerCase().includes("maghreb")) category="Maghreb";

                const nameMatch = lines[i].match(/,(.*)$/);
                const name = nameMatch ? nameMatch[1].trim() : "Unnamed";
                const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
                const logo = logoMatch ? logoMatch[1] : null;
                const url = lines[i+1] ? lines[i+1].trim() : null;
                if(!url || url.startsWith("#")) continue;
                if(!data[category]) data[category]=[];
                data[category].push({name,url,logo});
            }
        }

      // --- Load ALL Moroccan channels (ma.m3u) into Maghreb, robustly ---
if (!data["Maghreb"]) data["Maghreb"] = [];

const resMa = await fetch("https://iptv-org.github.io/iptv/countries/ma.m3u");
const textMa = await resMa.text();
const linesMa = textMa.split(/\r?\n/);

// counters (optional)
let extinfCount = 0;
let pushedCount = 0;

for (let i = 0; i < linesMa.length; i++) {
  const line = linesMa[i];
  if (!line.startsWith("#EXTINF")) continue;

  extinfCount++;

  // Extract name & logo (ignore group-title; we force Maghreb)
  const nameMatch = line.match(/,(.*)$/);
  const name = nameMatch ? nameMatch[1].trim() : "Unnamed";

  const logoMatch = line.match(/tvg-logo="(.*?)"/);
  const logo = logoMatch ? logoMatch[1] : null;

  // Find the first non-empty, non-comment line after #EXTINF => the URL
  let url = null;
  let j = i + 1;
  while (j < linesMa.length) {
    const candidate = (linesMa[j] || "").trim();
    if (candidate === "") { j++; continue; }
    if (candidate.startsWith("#")) { j++; continue; }
    url = candidate;
    break;
  }

  if (!url) continue;               // no playable line found
  if (url.startsWith("#")) continue; // safety (shouldn’t happen)

  // Don’t dedupe by name (names repeat a lot in iptv-org lists)
  data["Maghreb"].push({ name, url, logo });
  pushedCount++;

  // optional: skip ahead to the url line to avoid re-processing
  i = j;
}

// Optional debug (check in DevTools console)
// console.log("ma.m3u EXTINF entries:", extinfCount, "→ pushed to Maghreb:", pushedCount);


        // Add Bein Sports iframe channels
        if(!data["Sports"]) data["Sports"]=[];
        const beinChannels = [
          {name:"Bein Sports 1", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F201%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-1/"},
          {name:"Bein Sports 2", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F202%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-2/"},
          {name:"Bein Sports 3", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F203%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-3/"},
          {name:"Bein Sports 4", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F204%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-4/"},
          {name:"Bein Sports 5", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F205%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-5/"},
          {name:"Bein Sports 6", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F206%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-6/"},
          {name:"Bein Sports 7", logo:"https://img.kooora.com/?i=o%2Fh%2F1%2F207%2Fbein-sports-hd-1.png", iframe:"https://aa.yalla1shoot.club/albaplayer/sports-7/"}
        ];
        const existingSports = new Set(data["Sports"].map(c=>c.name));
        beinChannels.forEach(c=>{
            if(!existingSports.has(c.name)) data["Sports"].push(c);
        });

        showCategories();
    }catch(e){
        console.error(e);
        alert("Failed to load playlist");
    }
}


function showCategories(){
    loading.classList.add('hidden');
    categoriesView.classList.remove('hidden');
    channelsView.classList.add('hidden');
    playerView.classList.add('hidden');
    categoriesView.innerHTML='';
    categoryItems=[];
    Object.keys(data).forEach(cat=>{
        const icon = categoryIcons[cat]||"fa-tv";
        const card = document.createElement('div');
        card.className='card p-4 flex flex-col items-center';
        card.innerHTML=`<div class="w-16 h-16 mb-2 flex justify-center items-center text-2xl"><i class="fas ${icon}"></i></div>
                        <p class="text-center">${cat}</p>`;
        card.addEventListener('click',()=>showChannels(cat));
        categoriesView.appendChild(card);
        categoryItems.push(card);
    });
}

function showChannels(cat){
    currentCategory=cat;
    categoriesView.classList.add('hidden');
    channelsView.classList.remove('hidden');
    playerView.classList.add('hidden');
    channelsList.innerHTML='';
    channelItems=[];
    if(!data[cat]) return;
    data[cat].forEach(ch=>{
        const card=document.createElement('div');
        card.className='card p-2';
        card.innerHTML=`<div class="channel-logo mb-2 flex items-center justify-center">
            ${ch.logo?`<img class="w-full h-full object-contain p-2" src="${ch.logo}" alt="${ch.name}">`:`<i class="fas fa-play-circle text-4xl text-gray-400"></i>`}
        </div><p>${ch.name}</p>`;
        card.addEventListener('click',()=>playChannel(ch));
        channelsList.appendChild(card);
        channelItems.push(card);
    });
    searchInput.value='';
}

function playChannel(ch){
    categoriesView.classList.add('hidden');
    channelsView.classList.add('hidden');
    playerView.classList.remove('hidden');
    channelName.textContent=ch.name;
    playingLogo.src=ch.logo||'';
    playingChannel.textContent=ch.name;
    playingCategory.textContent=currentCategory;

    stopPlayback();

    if(ch.iframe){
        videoContainer.classList.add('hidden');
        iframeContainer.classList.remove('hidden');
        iframePlayer.src=ch.iframe;
    }else{
        iframeContainer.classList.add('hidden');
        videoContainer.classList.remove('hidden');
        if(Hls.isSupported()){
            currentHls = new Hls();
            currentHls.loadSource(ch.url);
            currentHls.attachMedia(videoPlayer);
            currentHls.on(Hls.Events.MANIFEST_PARSED, ()=>videoPlayer.play().catch(()=>{}));
            currentHls.on(Hls.Events.ERROR,(event,data)=>{
                if(data.fatal){
                    switch(data.type){
                        case Hls.ErrorTypes.NETWORK_ERROR: currentHls.startLoad(); break;
                        case Hls.ErrorTypes.MEDIA_ERROR: currentHls.recoverMediaError(); break;
                        default: stopPlayback(); alert('Playback error'); break;
                    }
                }
            });
        }else{
            videoPlayer.src = ch.url;
            videoPlayer.play().catch(()=>{});
        }
    }
}

function stopPlayback(){
    if(currentHls){ 
        try{ currentHls.destroy(); }catch{} 
        currentHls = null; 
    }
    videoPlayer.pause();
    videoPlayer.removeAttribute('src');
    videoPlayer.load();
    iframePlayer.src = '';
}

// Back buttons
backToChannels.addEventListener('click',()=>{
    stopPlayback();
    playerView.classList.add('hidden');
    showChannels(currentCategory);
});
backToCategories.addEventListener('click',()=>{
    stopPlayback();
    channelsView.classList.add('hidden');
    showCategories();
});

// Search filter
searchInput.addEventListener('input',(e)=>{
    const query = e.target.value.toLowerCase();
    channelItems.forEach(card=>{
        const name = card.querySelector('p').textContent.toLowerCase();
        card.style.display = name.includes(query) ? 'block' : 'none';
    });
});

loadPlaylist();
</script>

<script>
  // Unlock site after 3 GO clicks
  let goClicks = 0;
  function fakeGo() {
    goClicks++;
    if (goClicks >= 3) {
      document.getElementById("fakeLogin").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
    }
  }
</script>

</div> <!-- close #mainContent -->
</body>
</html>
